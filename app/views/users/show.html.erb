<div class="show-user-page">
  <div class="container">
    <div class="row-header">
      <div class="col-full">
        <h1><%= @user.full_name %></h1>
        <h3><%= @user.email %></h3>
      </div>
    </div>
    <div class="row-controls">
      <div class="col-full">
        <% if current_user?( @user ) %>
          <%= link_to 'Find Friends', users_path, :class => 'btn btn-primary' %>
        <% elsif request = @user.pending_request( current_user ) %>
          <%= link_to 'Accept Request', accept_friend_path( :friendship_id => request.id ), :class => 'btn btn-primary', :method => 'post' %>
        <% elsif !@user.has_friend?( current_user ) %>
          <%= link_to 'Request Friend', add_friend_path( :friend_id => @user.id ), :class => 'btn btn-primary', :method => 'post' %>
        <% end %>
      </div>
    </div>
    <% if current_user?( @user ) && @user.friend_requests.count > 0 %>
    <div class="row-requests">
      <div class="col-full">
        <div class="header">
          Pending Requests
        </div>
        <ul class="friend-request-list">
          <% @user.friend_requests( :include_users => true ).each do |request| %>
            <li><%= request.user.full_name %> <%= link_to 'Accept', accept_friend_path( :friendship_id => request.id ), :method => :post %> <%= link_to 'Deny', deny_friend_path( :friendship_id => request.id ), :method => :post, :data => { :confirm => 'Are you sure?' } %></li>
          <% end %>
        </ul>
      </div>
    </div>
    <% end %>
    <% if current_user?( @user ) || @user.has_friend?( current_user ) %>
    <div class="row-friends">
      <div class="col-full">
        <div class="header">
          Friends
        </div>
        <ul class="friend-list">
          <% @user.friends.each do |friend| %>
            <li><%= link_to friend.full_name, user_path( friend ) %></li>
          <% end %>
        </ul>
      </div>
    </div>
    <% end %>
    <% if current_user?( @user ) || @user.has_friend?( current_user ) %>
    <div class="row-gift-requests">
      <div class="col-centered-form">
        <div class="header">
          Gift Requests
        </div>
        <ul class="gift-list">
          <% @user.gift_requests.each do |gift_request| %>
            <li><%= gift_request.name %></li>
          <% end %>
        </ul>
        <% if current_user?( @user ) %>
          <%= form_for @user, :html => { :class => "form-centered" } do |f| %>
            <div id="gift-requests"></div>
            <div class="form-group">
              <div class="col-submit">
                <%= link_to_add_fields 'Add Another Gift', f, :gift_requests, :layout_dir => 'users', :insert_element => '#gift-requests', :link_options => { :class => 'btn btn-submit' }  %>
                <%= f.submit 'Submit Gifts', :class => 'btn btn-submit' %>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
    <% end %>
  </div>
</div>